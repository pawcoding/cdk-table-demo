<table
  cdk-table
  [dataSource]="dataSource"
  [trackBy]="trackById"
  [fixedLayout]="!resizing()"
  class="mb-16 w-full table-fixed"
>
  @for (column of TEXT_COLUMNS; track column) {
    <ng-container
      [cdkColumnDef]="column"
      [sticky]="stickyColumns()[column]"
    >
      <th
        cdk-header-cell
        *cdkHeaderCellDef
        [style.width.px]="columnWidths()[column] ?? columns()[column]?.defaultWidth"
      >
        <app-header-cell [key]="column" />
      </th>
      <td
        cdk-cell
        *cdkCellDef="let person"
      >
        {{ person[column] }}
      </td>
    </ng-container>
  }
  @for (column of DATE_COLUMNS; track column) {
    <ng-container
      [cdkColumnDef]="column"
      [sticky]="stickyColumns()[column]"
    >
      <th
        cdk-header-cell
        *cdkHeaderCellDef
        [style.width.px]="columnWidths()[column] ?? columns()[column]?.defaultWidth"
      >
        <app-header-cell [key]="column" />
      </th>
      <td
        cdk-cell
        *cdkCellDef="let person"
      >
        {{ person[column] | date }}
      </td>
    </ng-container>
  }

  <ng-container
    cdkColumnDef="country"
    [sticky]="stickyColumns().country"
  >
    <th
      cdk-header-cell
      *cdkHeaderCellDef
      [style.width.px]="columnWidths().country ?? columns().country?.defaultWidth"
    >
      <app-header-cell key="country" />
    </th>
    <td
      cdk-cell
      *cdkCellDef="let person"
    >
      {{ person.country | country }}
    </td>
  </ng-container>

  <ng-container
    cdkColumnDef="avatarUrl"
    [sticky]="stickyColumns().avatarUrl"
  >
    <th
      cdk-header-cell
      *cdkHeaderCellDef
      [style.width.px]="columnWidths().avatarUrl ?? columns().avatarUrl?.defaultWidth"
    >
      <app-header-cell key="avatarUrl" />
    </th>
    <td
      cdk-cell
      *cdkCellDef="let person"
    >
      <img
        [src]="person.avatarUrl"
        class="mx-auto rounded-full"
        alt="avatar"
        width="32"
        height="32"
      />
    </td>
  </ng-container>

  <tr
    cdk-header-row
    *cdkHeaderRowDef="visibleColumns(); sticky: true"
  ></tr>
  <tr
    cdk-row
    *cdkRowDef="let person; columns: visibleColumns()"
  ></tr>
</table>

<app-action-bar />

<app-side-sheet
  [(isOpen)]="showColumnOrderSideSheet"
  label="Column configuration"
  description="Drag and drop the columns to change their order or toggle their visibility using the eye icon. Dragging a column above the pin line will make it stick to the left while scrolling the table horizontally."
>
  <app-column-order-menu />

  <div
    side-sheet-footer
    class="flex justify-end"
    (click)="resetColumns()"
  >
    <button
      class="cursor-pointer rounded-sm px-3 py-2 hover:bg-neutral-200 dark:hover:bg-neutral-700"
    >
      Reset columns
    </button>
  </div>
</app-side-sheet>
